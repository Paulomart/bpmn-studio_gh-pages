"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const git_1 = require("../git/git");
const package_version_1 = require("../versions/package_version");
const setup_git_and_npm_connections_1 = require("./internal/setup-git-and-npm-connections");
const shell_1 = require("../cli/shell");
const printMultiLineString_1 = require("../cli/printMultiLineString");
const notifier_1 = require("../slack/notifier");
const create_release_announcement_1 = require("./internal/create-release-announcement");
const COMMAND_NAME = 'publish-releasenotes-on-slack';
const BADGE = `[${COMMAND_NAME}]\t`;
const DOC = `
Publishes the releasenotes for the current version on slack.

To use this command, an incoming webhook for slack is required and must be configured as an environment variable named 'SLACK_WEBHOOK'.
`;
// DOC: see above
async function run() {
    setup_git_and_npm_connections_1.setupGit();
    printInfo();
    annotatedSh('git config user.name');
    annotatedSh('git config user.email');
    const releasenotes = await create_release_announcement_1.getReleaseAnnouncement();
    await notifier_1.sendSlackMessage(releasenotes);
    return true;
}
exports.run = run;
function getShortDoc() {
    return DOC.trim().split('\n')[0];
}
exports.getShortDoc = getShortDoc;
function printHelp() {
    console.log(`Usage: ci_tools ${COMMAND_NAME}`);
    console.log('');
    console.log(DOC.trim());
}
exports.printHelp = printHelp;
function annotatedSh(cmd) {
    console.log(`${BADGE}|>>> ${cmd}`);
    const output = shell_1.sh(cmd);
    printMultiLineString_1.printMultiLineString(output, `${BADGE}| `);
    return output;
}
function printInfo() {
    const packageVersion = package_version_1.getPackageVersion();
    const packageVersionTag = package_version_1.getPackageVersionTag();
    const branchName = git_1.getGitBranch();
    console.log(`${BADGE}packageVersion:`, packageVersion);
    console.log(`${BADGE}packageVersionTag:`, packageVersionTag);
    console.log(`${BADGE}branchName:`, branchName);
    console.log('');
}
//# sourceMappingURL=publish-releasenotes-on-slack.js.map